---
title: æ®‹å·®è¿æ¥ï¼ˆResidual Connectionï¼‰
date: 2024-09-09
updated:
tags: [æ·±åº¦å­¦ä¹ ,æ·±åº¦å­¦ä¹ ]
categories: æ·±åº¦å­¦ä¹ 
keywords:
description:
top_img: /img/default_top_img.jpg
comments:
cover: /img/cover/æ®‹å·®è¿æ¥.png
toc:
toc_number:
toc_style_simple:
copyright:
copyright_author:
copyright_author_href:
copyright_url:
copyright_info:
mathjax:
katex:
aplayer:
highlight_shrink:
aside:
abcjs:
---

# æ®‹å·®è¿æ¥ï¼ˆResidual Connectionï¼‰

[ã€æ·±åº¦å­¦ä¹  | ResNetæ ¸å¿ƒæ€æƒ³ã€‘æ®‹å·®è¿æ¥ & è·³è·ƒè¿æ¥ï¼šè®©ä¿¡æ¯è‡ªç”±æµåŠ¨çš„ç¥å¥‡ä¹‹é“-CSDNåšå®¢](https://blog.csdn.net/weixin_66526635/article/details/132411168?ops_request_misc=%7B%22request%5Fid%22%3A%223415ECC2-BAC2-49E8-A135-FB3D948A035C%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&request_id=3415ECC2-BAC2-49E8-A135-FB3D948A035C&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-132411168-null-null.142^v100^pc_search_result_base8&utm_term=æ®‹å·®è¿æ¥å’Œè·³è·ƒè¿æ¥&spm=1018.2226.3001.4187)

![image-20240909210607856.png](https://s2.loli.net/2024/09/09/bNeC7wGVQOBK4on.png)

## èƒŒæ™¯ï¼š

åœ¨æ·±åº¦ç¥ç»ç½‘ç»œä¸­ï¼Œéšç€å±‚æ•°çš„å¢åŠ ï¼Œç½‘ç»œçš„æ€§èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¼šæé«˜ï¼ˆç½‘æ ¼é€€åŒ– Degradationï¼‰ã€‚ç„¶è€Œï¼Œæ·±åº¦ç½‘ç»œçš„è®­ç»ƒä¹Ÿé¢ä¸´ç€ä¸€äº›æŒ‘æˆ˜ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯æ¢¯åº¦æ¶ˆå¤±æˆ–æ¢¯åº¦çˆ†ç‚¸çš„é—®é¢˜ã€‚å½“åå‘ä¼ æ’­è¿‡ç¨‹ä¸­çš„æ¢¯åº¦å˜å¾—éå¸¸å°æˆ–éå¸¸å¤§æ—¶ï¼Œç½‘ç»œçš„å‚æ•°æ›´æ–°ä¼šå—åˆ°å½±å“ï¼Œå¯¼è‡´è®­ç»ƒå˜å¾—å›°éš¾ã€‚

### æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸ï¼š

#### æ¦‚å¿µï¼š

æ¢¯åº¦æ¶ˆå¤±ï¼šåœ¨æ·±å±‚ç½‘ç»œä¸­ï¼Œæ¢¯åº¦éœ€è¦é€šè¿‡å¤šä¸ªå±‚æ¬¡è¿›è¡Œåå‘ä¼ æ’­ã€‚æ ¹æ®é“¾å¼æ³•åˆ™ï¼Œæ¢¯åº¦åœ¨ä¼ æ’­è¿‡ç¨‹ä¸­ä¼šä¸æ–­ç›¸ä¹˜ï¼Œå½“å±‚æ•°è¾ƒå¤šæ—¶ï¼Œæ¢¯åº¦å€¼å¯èƒ½ä¼šä»¥æŒ‡æ•°å½¢å¼è¡°å‡å¹¶è¶‹è¿‘äºé›¶ï¼Œå¯¼è‡´æ¢¯åº¦æ¶ˆå¤±ã€‚

æ¢¯åº¦çˆ†ç‚¸ï¼šæ·±å±‚ç½‘ç»œä¸­çš„æ¢¯åº¦åœ¨ä¼ æ’­è¿‡ç¨‹ä¸­ä¹Ÿå¯èƒ½å› é“¾å¼æ³•åˆ™çš„è¿ä¹˜æ•ˆåº”è€Œè¿…é€Ÿå¢é•¿ï¼Œç”šè‡³å‘ˆæŒ‡æ•°çº§å¢é•¿ï¼Œå¯¼è‡´ç½‘ç»œå‚æ•°æ›´æ–°è¿‡å¤§ï¼Œç½‘ç»œä¸ç¨³å®šã€‚

#### ä¸ºä»€ä¹ˆä¼šæ¢¯åº¦æ¶ˆå¤±ï¼š

åœ¨ä½¿ç”¨æ¿€æ´»å‡½æ•°ä¸ºSigmoidæˆ–Tanhç­‰é¥±å’Œæ¿€æ´»å‡½æ•°æ—¶ï¼Œå› ä¸ºè¿™äº›å‡½æ•°åœ¨è¾“å…¥è¾ƒå¤§æˆ–è¾ƒå°çš„æƒ…å†µä¸‹ä¼šé¥±å’Œå¹¶å¯¼è‡´æ¢¯åº¦å˜å¾—éå¸¸å°ã€‚å½“è¾“å…¥æ¥è¿‘1æ—¶ï¼ŒSigmoidå‡½æ•°çš„è¾“å‡ºå€¼ä¼šæ¥è¿‘äº1ï¼Œå¯¼æ•°è¶‹è¿‘äº0ã€‚äºæ˜¯åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ï¼Œæ¢¯åº¦çš„ä¹˜ç§¯ä¼šè¶‹è¿‘äºé›¶ã€‚ï¼ˆä¸ºäº†ç¼“è§£æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼Œæ·±åº¦ç¥ç»ç½‘ç»œä¸­å¸¸å¸¸ä½¿ç”¨å…¶ä»–ç±»å‹çš„æ¿€æ´»å‡½æ•°ï¼Œå¦‚ReLUï¼‰

æ·±åº¦ç¥ç»ç½‘ç»œä¸­ï¼Œæ¢¯åº¦æ˜¯é€šè¿‡é“¾å¼æ³•åˆ™è¿›è¡Œåå‘ä¼ æ’­çš„ã€‚æ¯ä¸€å±‚çš„æ¢¯åº¦éƒ½éœ€è¦ä¸å‰ä¸€å±‚çš„æ¢¯åº¦ç›¸ä¹˜ï¼Œç„¶åå†ä¼ é€’åˆ°å‰ä¸€å±‚ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°ä¼ é€’åˆ°ç½‘ç»œçš„è¾“å…¥å±‚ã€‚å¦‚æœç½‘ç»œå±‚æ•°è¾ƒå¤šï¼Œé‚£ä¹ˆåœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ä¼šç»è¿‡å¤šæ¬¡è¿ç»­çš„ä¹˜æ³•æ“ä½œï¼Œä»è€Œå¯èƒ½å¯¼è‡´æ¢¯åº¦çš„å€¼æŒ‡æ•°çº§åœ°å‡å°ï¼Œæœ€ç»ˆè¶‹è¿‘äºé›¶ï¼Œå³æ¢¯åº¦æ¶ˆå¤±ã€‚
![image-20240909211427431.png](https://s2.loli.net/2024/09/09/253BReLWoJ4ApOQ.png)

#### ä¸ºä»€ä¹ˆä¼šæ¢¯åº¦çˆ†ç‚¸ï¼š

- ç¥ç»ç½‘ç»œç»è¿‡å¤šæ¬¡çš„è¿ä¹˜ï¼Œæ¯æ¬¡ä¹˜æ³•æ“ä½œéƒ½å¯èƒ½å°†æ¢¯åº¦æ”¾å¤§ï¼Œä»è€Œå¯¼è‡´æ¢¯åº¦å€¼å˜å¾—éå¸¸å¤§ï¼Œä»è€Œå¯¼è‡´æ¢¯åº¦çˆ†ç‚¸ã€‚

- æ¢¯åº¦çˆ†ç‚¸ä¼šå¯¼è‡´ç½‘ç»œçš„æƒé‡å‚æ•°æ›´æ–°è¿‡å¤§ï¼Œä»è€Œä½¿å¾—æ¨¡å‹çš„è®­ç»ƒå˜å¾—ä¸ç¨³å®šã€‚

  ![image-20240909211523062.png](https://s2.loli.net/2024/09/09/3uFWrCbyYoi7MNL.png)

## æ®‹å·®è¿æ¥çš„æ€æƒ³ï¼š

æ®‹å·®è¿æ¥çš„æ ¸å¿ƒæ€æƒ³æ˜¯åœ¨ç½‘ç»œçš„ä¸€å±‚æˆ–å¤šå±‚ä¹‹é—´å¼•å…¥ç›´æ¥è¿æ¥ï¼Œä½¿å¾—è¿™äº›å±‚çš„è¾“å‡ºä¸ä»…åŒ…æ‹¬ç»è¿‡éçº¿æ€§å˜æ¢çš„ç‰¹å¾ï¼Œè¿˜åŒ…æ‹¬æœªç»å¤„ç†çš„è¾“å…¥ç‰¹å¾ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯å…è®¸ç½‘ç»œå­¦ä¹ åˆ°çš„æ˜¯è¾“å…¥å’Œè¾“å‡ºä¹‹é—´çš„æ®‹å·®ï¼ˆå³å·®å¼‚ï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥å­¦ä¹ ä¸€ä¸ªå®Œæ•´çš„æ˜ å°„ã€‚è¿™ç§æ–¹å¼æœ‰åŠ©äºæ¢¯åº¦åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­æ›´æœ‰æ•ˆåœ°å›æµï¼Œå‡è½»æ·±åº¦ç½‘ç»œä¸­æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚

æ®‹å·®è¿æ¥çš„æ ¸å¿ƒæ€æƒ³æ˜¯å¼•å…¥ä¸€ä¸ªâ€œå¿«æ·è¿æ¥â€ï¼ˆshortcut connectionï¼‰æˆ–â€œè·³è¿‡è¿æ¥â€ï¼ˆskip connectionï¼‰ï¼Œå…è®¸æ•°æ®ç»•è¿‡ä¸€äº›å±‚ç›´æ¥ä¼ æ’­ã€‚è¿™æ ·ï¼Œç½‘ç»œä¸­çš„ä¸€éƒ¨åˆ†å¯ä»¥ç›´æ¥å­¦ä¹ åˆ°è¾“å…¥ä¸è¾“å‡ºä¹‹é—´çš„æ®‹å·®ï¼ˆå³å·®å¼‚ï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥å­¦ä¹ åˆ°æ˜ å°„æœ¬èº«ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›å­¦ä¹ çš„ç›®æ ‡æ˜ å°„æ˜¯ H(x)ï¼Œæˆ‘ä»¬è®©ç½‘ç»œå­¦ä¹ æ®‹å·®æ˜ å°„ F(x)=H(x)âˆ’xã€‚å› æ­¤ï¼ŒåŸå§‹çš„ç›®æ ‡æ˜ å°„å¯ä»¥è¡¨ç¤ºä¸º F(x)+xã€‚

**è¡¥ä¸€ä¸ªè·³è¿‡è¿æ¥ï¼ˆskip connectionsï¼‰ï¼š**

Skip connectionsçš„å®ç°æ–¹å¼é€šå¸¸æ˜¯å°†æŸä¸€å±‚çš„è¾“å‡ºï¼ˆé€šå¸¸ç»è¿‡ä¸€ä¸ªæ’ç­‰æ˜ å°„æˆ–ç®€å•çš„çº¿æ€§å˜æ¢ï¼‰ç›´æ¥åŠ åˆ°ä¸‹ä¸€å±‚ï¼ˆæˆ–æ›´æ·±å±‚ï¼‰çš„è¾“å‡ºä¸Šã€‚ è¿™æ ·ï¼Œç½‘ç»œçš„è¾“å‡ºå°±å¯ä»¥è¡¨ç¤ºä¸ºè¾“å…¥çš„éçº¿æ€§å˜æ¢ä¸è¾“å…¥çš„çº¿æ€§å åŠ ï¼Œå³y = F(x) + xï¼Œå…¶ä¸­F(x)è¡¨ç¤ºè¾“å…¥xç»è¿‡ä¸€ç³»åˆ—éçº¿æ€§å˜æ¢åçš„è¾“å‡ºï¼Œxè¡¨ç¤ºç›´æ¥ä¼ é€’çš„è¾“å…¥ã€‚
**e.g. :**

- **æ¨¡å‹ä¸€å…±56å±‚ï¼Œè‹¥ç¬¬20å±‚æ—¶æ¨¡å‹å·²ç»å……åˆ†å­¦ä¹ è¾¾åˆ°æµ‹è¯•é›†æœ€ä½³æ•ˆæœï¼Œåˆ™è®©ä»21å±‚å¼€å§‹åˆ°ç¬¬56å±‚å­¦ä¹ ä¸€ç§æ’ç­‰å˜æ¢ï¼Œåœ¨æœ€åä¸€å±‚å°†ç¬¬20å±‚çš„è¾“å‡ºæ’ç­‰æ˜ å°„å‡ºæ¥ã€‚**

  ![image-20240909211034228.png](https://s2.loli.net/2024/09/09/wjOu1lXDdct64qM.png)

  æ®‹å·®è¿æ¥æ˜¯ä¸€ç§è·³è¿‡è¿æ¥ã€‚

## å…·ä½“å®ç°ï¼š

åœ¨ä¼ ç»Ÿçš„æ·±åº¦ç¥ç»ç½‘ç»œä¸­ï¼Œæ¯ä¸€å±‚çš„è¾“å‡ºæ˜¯åŸºäºå‰ä¸€å±‚çš„è¾“å‡ºè¿›è¡Œè®¡ç®—ã€‚å½“ç½‘ç»œå±‚æ¬¡å¢åŠ æ—¶ï¼Œç½‘ç»œçš„è®­ç»ƒå˜å¾—å›°éš¾ï¼Œå› ä¸ºæ¢¯åº¦åœ¨åå‘ä¼ æ’­è¿‡ç¨‹ä¸­å®¹æ˜“æ¶ˆå¤±æˆ–çˆ†ç‚¸ã€‚æ®‹å·®è¿æ¥é€šè¿‡æ·»åŠ é¢å¤–çš„â€œå¿«æ·è¿æ¥â€ï¼ˆshortcut connectionsï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™äº›å¿«æ·è¿æ¥å…è®¸ä¸€éƒ¨åˆ†è¾“å…¥ç›´æ¥è·³è¿‡ä¸€ä¸ªæˆ–å¤šä¸ªå±‚ä¼ åˆ°æ›´æ·±çš„å±‚ï¼Œä»è€Œåœ¨ä¸å¢åŠ é¢å¤–å‚æ•°æˆ–è®¡ç®—å¤æ‚åº¦çš„æƒ…å†µä¸‹ï¼Œä¿ƒè¿›æ¢¯åº¦çš„ç›´æ¥åå‘ä¼ æ’­ã€‚

å…·ä½“æ¥è¯´ï¼šè®¾æƒ³ä¸€ä¸ªç®€å•çš„ç½‘ç»œå±‚ï¼Œå…¶è¾“å…¥ä¸º ğ‘¥ï¼Œè¦é€šè¿‡ä¸€ä¸ªéçº¿æ€§å˜æ¢ ğ¹(ğ‘¥) æ¥å¾—åˆ°è¾“å‡ºã€‚åœ¨æ²¡æœ‰æ®‹å·®è¿æ¥çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå±‚çš„è¾“å‡ºå°±æ˜¯ ğ¹(ğ‘¥)ã€‚å½“å¼•å…¥æ®‹å·®è¿æ¥åï¼Œè¿™ä¸ªå±‚çš„è¾“å‡ºå˜ä¸ºğ¹(ğ‘¥) + ğ‘¥ã€‚è¿™é‡Œçš„ğ‘¥æ˜¯ç›´æ¥ä»è¾“å…¥åˆ°è¾“å‡ºçš„è·³è¿‡è¿æ¥ï¼ˆSkip Connectionï¼‰ï¼Œğ¹(ğ‘¥) + ğ‘¥å³æ˜¯è€ƒè™‘äº†è¾“å…¥æœ¬èº«çš„æ®‹å·®è¾“å‡ºã€‚è¿™æ ·è®¾è®¡å…è®¸ç½‘ç»œåœ¨éœ€è¦æ—¶å€¾å‘äºå­¦ä¹ æ›´ç®€å•çš„å‡½æ•°ï¼ˆä¾‹å¦‚ï¼Œå½“ ğ¹(ğ‘¥) æ¥è¿‘0æ—¶ï¼Œè¾“å‡ºæ¥è¿‘è¾“å…¥ï¼‰ï¼Œè¿™æœ‰åŠ©äºæé«˜ç½‘ç»œçš„è®­ç»ƒé€Ÿåº¦å’Œå‡†ç¡®æ€§ã€‚


## ä¼˜ç‚¹ï¼š

1. æ¢¯åº¦ä¼ æ’­ï¼š æ¢¯åº¦èƒ½å¤Ÿæ›´å®¹æ˜“åœ°é€šè¿‡æ®‹å·®è¿æ¥ä¼ é€’ã€‚åœ¨åå‘ä¼ æ’­æ—¶ï¼Œç”±äºç›´æ¥çš„è·³è¿‡è¿æ¥ï¼Œæ¢¯åº¦ä¸ä¼šæ¶ˆå¤±å¾—å¤ªå¿«ï¼Œä½¿å¾—è®­ç»ƒæ›´åŠ å®¹æ˜“ã€‚

2. ä¿¡æ¯æµåŠ¨ï¼š æ®‹å·®è¿æ¥å…è®¸ä¿¡æ¯ç›´æ¥ä»è¾“å…¥å±‚æµå‘åç»­å±‚ï¼Œå‡è½»äº†æ·±åº¦ç½‘ç»œä¸­ä¿¡æ¯éš¾ä»¥ä¼ é€’çš„é—®é¢˜ï¼Œæœ‰åŠ©äºä¿æŒæ›´åŠ ç›´æ¥çš„ä¿¡æ¯æµåŠ¨ã€‚

3. ç½‘ç»œæ·±åº¦ï¼š å…è®¸æ„å»ºéå¸¸æ·±çš„ç½‘ç»œè€Œä¸ä¼šé‡åˆ°æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼Œä»è€Œæ¨åŠ¨äº†æ·±åº¦å­¦ä¹ æ¨¡å‹çš„å‘å±•ã€‚

   ```python
   import torch
   import torch.nn as nn
   import torch.nn.functional as F
    
   # å®šä¹‰æ®‹å·®å—
   class ResidualBlock(nn.Module):
       def __init__(self, in_channels, out_channels, stride=1):
           super(ResidualBlock, self).__init__()
    
           # ç¬¬ä¸€ä¸ªå·ç§¯å±‚
           self.conv1 = nn.Conv2d(in_channels, out_channels, kernel_size=3, stride=stride, padding=1, bias=False)
           self.bn1 = nn.BatchNorm2d(out_channels)
    
           # æ¿€æ´»å‡½æ•°
           self.relu = nn.ReLU(inplace=True)
    
           # ç¬¬äºŒä¸ªå·ç§¯å±‚
           self.conv2 = nn.Conv2d(out_channels, out_channels, kernel_size=3, stride=1, padding=1, bias=False)
           self.bn2 = nn.BatchNorm2d(out_channels)
    
           # å¦‚æœè¾“å…¥å’Œè¾“å‡ºçš„é€šé“æ•°ä¸ä¸€è‡´ï¼Œéœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œç”¨äºæ®‹å·®è¿æ¥
           self.shortcut = nn.Sequential()
           if stride != 1 or in_channels != out_channels:
               self.shortcut = nn.Sequential(
                   nn.Conv2d(in_channels, out_channels, kernel_size=1, stride=stride, bias=False),
                   nn.BatchNorm2d(out_channels)
               )
    
       def forward(self, x):
           residual = x  # ä¿å­˜è¾“å…¥ï¼Œç”¨äºæ®‹å·®è¿æ¥
    
           # ç¬¬ä¸€ä¸ªå·ç§¯å—
           out = self.conv1(x)
           out = self.bn1(out)
           out = self.relu(out)
    
           # ç¬¬äºŒä¸ªå·ç§¯å—
           out = self.conv2(out)
           out = self.bn2(out)
    
           out += self.shortcut(residual)  # æ®‹å·®è¿æ¥
           out = self.relu(out)
    
           return out
    
   # å®šä¹‰ResNetæ¨¡å‹
   class ResNet(nn.Module):
       def __init__(self, block, layers, num_classes=10):
           super(ResNet, self).__init__()
           self.in_channels = 64  # è¾“å…¥é€šé“æ•°
           self.conv1 = nn.Conv2d(3, 64, kernel_size=3, stride=1, padding=1, bias=False)
           self.bn1 = nn.BatchNorm2d(64)
           self.relu = nn.ReLU(inplace=True)
    
           # é€šè¿‡make_layerå‡½æ•°æ„å»ºResNetçš„å„å±‚
           self.layer1 = self.make_layer(block, 64, layers[0], stride=1)
           self.layer2 = self.make_layer(block, 128, layers[1], stride=2)
           self.layer3 = self.make_layer(block, 256, layers[2], stride=2)
           self.layer4 = self.make_layer(block, 512, layers[3], stride=2)
    
           # å…¨å±€å¹³å‡æ± åŒ–å±‚
           self.avg_pool = nn.AdaptiveAvgPool2d((1, 1))
    
           # å…¨è¿æ¥å±‚
           self.fc = nn.Linear(512, num_classes)
    
       # æ„å»ºæ¯ä¸€å±‚çš„å‡½æ•°
       def make_layer(self, block, out_channels, blocks, stride):
           layers = []
           layers.append(block(self.in_channels, out_channels, stride))
           self.in_channels = out_channels
           for _ in range(1, blocks):
               layers.append(block(out_channels, out_channels, stride=1))
           return nn.Sequential(*layers)
    
       def forward(self, x):
           # ç¬¬ä¸€ä¸ªå·ç§¯å—
           out = self.conv1(x)
           out = self.bn1(out)
           out = self.relu(out)
    
           # åç»­å„å±‚çš„å·ç§¯å—
           out = self.layer1(out)
           out = self.layer2(out)
           out = self.layer3(out)
           out = self.layer4(out)
    
           # å…¨å±€å¹³å‡æ± åŒ–
           out = self.avg_pool(out)
           out = out.view(out.size(0), -1)
    
           # å…¨è¿æ¥å±‚
           out = self.fc(out)
    
           return out
    
   # åˆ›å»ºResNet18æ¨¡å‹
   model = ResNet(ResidualBlock, [2, 2, 2, 2])
    
   # æ‰“å°æ¨¡å‹ç»“æ„
   print(model)
   ```

   